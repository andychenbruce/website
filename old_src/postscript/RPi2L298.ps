%
%  PWM-Circuit.ps
%

90 90 translate
8  8 scale

/gs {gsave} def
/gr {grestore} def

/np {newpath} def
/cp {closepath} def
/m2 {moveto} def
/l2 {lineto} def
/r2 {rlineto} def
/tr {translate} def
/sk {stroke} def
/slw {setlinewidth} def

/circle {0 360 arc} def %% x y r circle
/circf {circle fill} def
/circs {circle sk} def

/fsz { /Helvetica-Bold findfont exch scalefont setfont } def

/showcc {gs m2 fsz dup stringwidth pop 2 div neg 0 r2 show gr} def %%  str sz x y
/showc {gs 0 setgray showcc gr} def

/box {
    gs
    setColor
    /H exch def
    /W exch def
    tr
    W neg H neg m2
    W     H neg l2
    W     H     l2
    W neg H     l2
    cp
    fill
    gr
} def 
    
/black  [0 0 0] def
/white  [0 0 0] def

/red    [1 0 0] def
/green  [0 1 0] def
/blue   [0 0 1] def

/purple [.8 .0 .8] def
/yellow [.8 .8 .0] def
/orange [1  .5  0] def
/brown  [.7 .6 .2] def
/redPCB [.8 .5 .2] def
/gold   [.8 .9 .3] def
/gray   [.6 .6 .6] def

/op 2 sqrt dup 2 add div def
/on op neg def


/setColor {
    aload
    pop
    setrgbcolor
} def

/octPath {
    np
    1 op m2
    op 1 l2
    on 1 l2
    -1 op l2
    -1 on l2
    on -1 l2
    op -1 l2
    1 on l2
    cp
} def

/octagon {
    gs
    tr
    octagonColor setColor
    octPath fill
    octPath 0 setgray 0 slw sk
    1 setgray
    np
    -.4 -.4 m2
    0.4 -.4 l2
    0.4 0.4 l2
    -.4 0.4 l2
    cp
    fill
    gr
} def


/screwHole {
    gs
    tr
    gold setColor
    0 0 2.0 circf
    1 setgray
    0 0 1.0 circf
    fill
    gr
} def

/bottomNumber {
    dup
    0.4 sub
    7.8 m2
    2 string cvs show
} def

/topNumber {
    dup dup 22 lt exch 36 gt or {
	dup
	0.5 sub
	13.5 m2
	1 add
	2 string cvs show
    }
    {
	pop
    } ifelse
} def

/gpioHeader {
    1.2 fsz
    /octagonColor gray def
    1 2 50 {
	dup 10 octagon
	dup 12 octagon
	dup bottomNumber
	topNumber
    } for
    -2.5 11 screwHole
    52.5 11 screwHole
    25 4 m2 (Raspberry Pi GPIO Hdr) 2 25 4 showc
} def
gpioHeader

%%%%%%%%%%%%  Draw wires

/topOctagon {
    /octagonColor exch def
    dup
    12 octagon
    octagonColor setColor
    dup 12.5 m2 15 l2 sk
} def

/bottomOctagon {
    /octagonColor exch def
    dup
    10 octagon
    octagonColor setColor
    dup 0.2 add 10.7 m2 .8 .8 r2 1 add 15 l2 sk
} def

0.5 slw
23 purple topOctagon
25 yellow topOctagon
31 blue   topOctagon
29 orange bottomOctagon
31 green  bottomOctagon
33 brown  bottomOctagon

/smallScrewHole {
    gs
    tr
    0.7 0.7 scale
    0 0 screwHole
    gr
} def

/blueBlock {
    gs
    tr
    rotate
    /X 1.5 def
    /Y 2.0 def
    /x X neg def
    /y Y neg def
    X Y tr
    /bb {np x y m2 X y l2 X Y l2 x Y l2 cp} def
    [.4 .5 1] setColor
    bb fill
    0 setgray 0 slw
    bb sk
    /H X 2 div def
    np x H m2 X H l2 cp sk

    0.5 slw np 0 0 m2 0 -4 l2 cp sk %% Wire lead
    
    0 H 1.4 mul .3 circf
    /C X Y sub def
    0 C 1 circf
    0.5 setgray
    0 C 0.6 circf
    gr
} def

/capacitor {
    gs
    tr
    0 setgray
    0 0 4 circf
    1 setgray
    0 0 3.8 circf

    0 setgray
    np
    0 0 4 -60 60 arc
    cp fill
    gr
} def

/diode {
    gs
    tr
    /W 3 def
    /w W neg def
    /H 1 def
    /h H neg def
    1 setgray
    np W H m2 w H l2 w h l2 W h l2 cp fill
    0 setgray
    /W 2 def
    /w W neg def
    /H 1.3 def
    /h H neg def
    np W H m2 w H l2 w h l2 W h l2 cp fill
    gr
} def

/L298 {
    gs
    tr
    /X 30 def
    /pcb {np 0 0 m2 X 0 l2 X X l2 0 X l2 cp} def
    redPCB setColor pcb fill
    0 slw 0 setgray pcb sk

    /A 0.07 X mul def
    /B X A sub def
    
    A A smallScrewHole
    A B smallScrewHole
    B A smallScrewHole
    B B smallScrewHole

    /oct {
	/octagonColor exch def
	2 mul X A 2.5 mul sub exch sub /x exch def
	x A octagon
    } def

    /octW { %% oct with wire
	oct
	octagonColor setColor
	np x dup A .5 sub m2 A 4 sub l2 cp sk
    } def
	
    /oct2 { gs 0 2 tr oct gr } def

    /foo { gs x A 4 sub tr np 0 0 m2 } def
    /diag {dup neg r2} def

    0.5 slw
    0 brown  octW foo 0 -12  l2  -.75  -.75 r2 0 -1 r2 sk gr
    2 purple octW foo 0 -0.2 l2 -7.75 -3    r2  0 -10 r2 sk gr
    3 green  octW foo 0 -6.5 l2 3.25 diag 0 -4 r2 sk gr
    5 blue   octW foo 0 -4   l2 6.25 diag 0 -3 r2 sk gr
    4 orange octW foo 0 -7.6 l2 3.25 diag 0 -3 r2 sk gr
    1 yellow octW foo 0 -5   l2 -7.75 -7.75 r2 0 -1 r2 sk gr
    0 gray   oct2
    5 gray   oct2
%%    

    0 4  0 blueBlock
    0 7  0 blueBlock
    0 10 0 blueBlock
    270 0  9 blueBlock
    270 0 12 blueBlock
    90 30 6 blueBlock
    90 30 9 blueBlock

    10 12 capacitor
    20  9 capacitor

    4 16 diode
    4 19 diode
    4 22 diode
    4 25 diode
    
    26 16 diode
    26 19 diode
    26 22 diode
    26 25 diode

    15 26 7 2 black box

    %% gs 0 setgray 15 26 tr np -7 -2 m2 7 -2 l2 7 2 l2 -7 2 l2 cp fill gr

    (L298) 5 15 18 showc
    gr
} def

10 30 L298

(Motor A) 3  2.0 38 showc
(Motor B) 3 48.0 38 showc

/doBattery {
    gs
    0.5 slw
    0 setgray
    /X 10 def
    /Y 20 def
    /W  6 def
    /H  4 def
    /w W neg def
    /h H neg def
    X Y tr
    red setColor
    np W 2 div neg H m2 0 3 r2 8.5 0 r2 0 1 r2 sk %% 12v wire
    (12 V) 2 W 2 div neg H 2 sub showcc
    0 setgray
    np W 2 div H     m2 0 1 r2 5.5 0 r2 0 3 r2 sk %% GND wire
    (GND) 2 W 2 div H 2 sub showcc
    (Battery) 3 0 -2 showc
    W 2 div H 2 div m2
    np w h m2 W h l2 W H l2 w H l2 cp sk
    
    
    gr
} def
doBattery

/lbl {
    gs
    exch
    setColor
    exch
    36.5 exch -2.2 mul 30 add tr
    /A 0.8 def
    /B A neg def
    /bx {np B B m2 A B l2 A A l2 B A l2 cp} def
    bx fill
    0 setgray
    bx stroke
    1.6 -0.5 m2 show
    gr
} def

/doLabels {
    0 slw
    1.5 fsz
    1 purple (GPIO-24 Motor-B Fwd) lbl
    2 yellow (GPIO-26 Motor-B Rev) lbl
    3 orange (GPIO-29 Motor-A Fwd) lbl
    4 green  (GPIO-31 Motor-A Rev) lbl
    5 blue   (GPIO-32 PWM0 EnA) lbl
    6 brown  (GPIO-33 PWM1 EnB) lbl
} def
doLabels

showpage

%
%   gs -sNODISPLAY RPi2L298.ps
%

